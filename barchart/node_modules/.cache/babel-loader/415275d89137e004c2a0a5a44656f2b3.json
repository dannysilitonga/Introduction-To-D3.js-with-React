{"ast":null,"code":"import * as d3 from 'd3';\nconst MARGIN = {\n  TOP: 30,\n  BOTTOM: 300,\n  LEFT: 90,\n  RIGHT: 30\n};\nconst WIDTH = 860 - MARGIN.LEFT - MARGIN.RIGHT;\nconst HEIGHT = 800 - MARGIN.TOP - MARGIN.BOTTOM;\nexport default class D3Chart {\n  constructor(element) {\n    const vis = this;\n    vis.svg = d3.select(element).append(\"svg\").attr(\"width\", WIDTH + MARGIN.LEFT + MARGIN.RIGHT).attr(\"height\", HEIGHT + MARGIN.TOP + MARGIN.BOTTOM).append(\"g\").attr(\"transform\", \"translate(\".concat(MARGIN.LEFT, \", \").concat(MARGIN.TOP, \")\"));\n    vis.xLabel = vis.svg.append(\"text\").attr(\"x\", WIDTH / 2).attr(\"y\", HEIGHT + 80).attr(\"text-anchor\", \"middle\").style(\"font-size\", \"19px\");\n    vis.svg.append(\"text\").attr(\"x\", -(HEIGHT / 2)).attr(\"y\", -75).attr(\"text-anchor\", \"middle\").text(\"Number of Views\").attr(\"transform\", \"rotate(-90)\");\n    vis.xAxisGroup = vis.svg.append(\"g\").attr(\"transform\", \"translate(0, \".concat(HEIGHT, \")\"));\n    vis.yAxisGroup = vis.svg.append(\"g\");\n    Promise.all([d3.json(\"https://sentimentviz-default-rtdb.firebaseio.com/top_videos_24_15_03.json\"), d3.json(\"https://sentimentviz-default-rtdb.firebaseio.com/top_videos_24_16_03.json\"), d3.json(\"https://sentimentviz-default-rtdb.firebaseio.com/top_videos_24_15_04.json\")]).then(datasets => {\n      vis.march15Data = restructureData(datasets[0]).slice(0, 20);\n      vis.march16Data = restructureData(datasets[1]).slice(0, 20);\n      vis.april15Data = restructureData(datasets[2]).slice(0, 20);\n      vis.update(\"march15\");\n    });\n  }\n  update(date) {\n    const vis = this;\n\n    //vis.data = (date == \"march15\") ? vis.march15Data : vis.april15Data;\n\n    if (date == \"march15\") vis.data = vis.march15Data;else if (date == \"april16\") vis.data = vis.march16Data;else if (date == \"april15\") vis.data = vis.april15Data;\n    const month = date.slice(0, -2).charAt(0).toUpperCase() + date.slice(0, -2).slice(1);\n    const convertedDate = date.substr(date.length - 2);\n    const converted_month_date = month.concat(\" \", convertedDate);\n\n    //console.log(\"converted date month\", converted_month_date)\n\n    vis.xLabel.text(\"Top Trending Videos on \".concat(converted_month_date));\n    const x = d3.scaleBand().range([0, WIDTH]).domain(vis.data.map(d => d.videoTitle)).padding(0.5);\n    const xAxisCall = d3.axisBottom(x);\n    vis.xAxisGroup.transition().duration(500).call(xAxisCall).selectAll(\"text\").style(\"font-size\", \"8px\").attr(\"transform\", \"translate(-10,0)rotate(-45)\").style(\"text-anchor\", \"end\");\n    const y = d3.scaleLinear().domain([d3.min(vis.data, d => d.videoCount) * 0.95, d3.max(vis.data, d => d.videoCount)]).range([HEIGHT, 0]);\n    const yAxisCall = d3.axisLeft(y);\n    vis.yAxisGroup.transition().duration(500).call(yAxisCall);\n    console.log(\"hello again\");\n\n    // DATA JOIN\n    const rects = vis.svg.selectAll(\"rect\").data(vis.data);\n\n    // EXIT \n    rects.exit().transition().duration(500).attr(\"height\", 0).attr(\"y\", HEIGHT).remove();\n\n    // UPDATE \n    rects.transition().duration(500).attr(\"x\", d => x(d.videoTitle)).attr(\"y\", d => y(d.videoCount)).attr(\"width\", x.bandwidth).attr(\"height\", d => HEIGHT - y(d.videoCount));\n\n    // ENTER\n    rects.enter().append(\"rect\").attr(\"x\", d => x(d.videoTitle)).attr(\"width\", x.bandwidth).attr(\"fill\", \"#5f0f40\").attr(\"y\", HEIGHT).transition().duration(500).attr(\"height\", d => HEIGHT - y(d.videoCount)).attr(\"y\", d => y(d.videoCount));\n  }\n}\nfunction restructureData(raw_data) {\n  var USAVideoCount = [];\n  for (const videoID in raw_data['US']) {\n    USAVideoCount.push({\n      videoTitle: videoID,\n      videoCount: Number(raw_data['US'][videoID]['view_count'])\n    });\n  }\n  USAVideoCount = USAVideoCount.sort((a, b) => a.videoCount < b.videoCount ? 1 : -1);\n  return USAVideoCount;\n}","map":{"version":3,"names":["d3","MARGIN","TOP","BOTTOM","LEFT","RIGHT","WIDTH","HEIGHT","D3Chart","constructor","element","vis","svg","select","append","attr","concat","xLabel","style","text","xAxisGroup","yAxisGroup","Promise","all","json","then","datasets","march15Data","restructureData","slice","march16Data","april15Data","update","date","data","month","charAt","toUpperCase","convertedDate","substr","length","converted_month_date","x","scaleBand","range","domain","map","d","videoTitle","padding","xAxisCall","axisBottom","transition","duration","call","selectAll","y","scaleLinear","min","videoCount","max","yAxisCall","axisLeft","console","log","rects","exit","remove","bandwidth","enter","raw_data","USAVideoCount","videoID","push","Number","sort","a","b"],"sources":["/workspace/Introduction-To-D3.js-with-React/barchart/src/D3Chart.js"],"sourcesContent":["import * as d3 from 'd3'\n\nconst MARGIN = { TOP: 30, BOTTOM: 300, LEFT: 90, RIGHT: 30 }\nconst WIDTH = 860 - MARGIN.LEFT - MARGIN.RIGHT;\nconst HEIGHT = 800 - MARGIN.TOP - MARGIN.BOTTOM;\n\nexport default class D3Chart {\n\tconstructor(element) {\n\t\tconst vis = this\n\n\t\tvis.svg = d3.select(element)\n\t\t\t.append(\"svg\")\n\t\t\t\t.attr(\"width\", WIDTH + MARGIN.LEFT + MARGIN.RIGHT)\n\t\t\t\t.attr(\"height\", HEIGHT + MARGIN.TOP + MARGIN.BOTTOM)\n\t\t\t.append(\"g\")\n\t\t\t\t.attr(\"transform\", `translate(${MARGIN.LEFT}, ${MARGIN.TOP})`)\n\n\t\tvis.xLabel = vis.svg.append(\"text\")\n\t\t\t.attr(\"x\", WIDTH / 2)\n\t\t\t.attr(\"y\", HEIGHT + 80)\n\t\t\t.attr(\"text-anchor\", \"middle\")\n\t\t\t.style(\"font-size\", \"19px\")\n\n\t\tvis.svg.append(\"text\")\n\t\t\t.attr(\"x\", -(HEIGHT / 2))\n\t\t\t.attr(\"y\", -75)\n\t\t\t.attr(\"text-anchor\", \"middle\")\n\t\t\t.text(\"Number of Views\")\n\t\t\t.attr(\"transform\", \"rotate(-90)\")\n\n\t\tvis.xAxisGroup = vis.svg.append(\"g\")\n\t\t\t.attr(\"transform\", `translate(0, ${HEIGHT})`)\n\n\t\tvis.yAxisGroup = vis.svg.append(\"g\")\n\n\t\tPromise.all([\n\t\t\td3.json(\"https://sentimentviz-default-rtdb.firebaseio.com/top_videos_24_15_03.json\"),\n\t\t\td3.json(\"https://sentimentviz-default-rtdb.firebaseio.com/top_videos_24_16_03.json\"),\n\t\t\td3.json(\"https://sentimentviz-default-rtdb.firebaseio.com/top_videos_24_15_04.json\")\n\t\t]).then((datasets) => {\n\t\t\t\n\t\t\tvis.march15Data = restructureData(datasets[0]).slice(0, 20)\n\t\t\tvis.march16Data = restructureData(datasets[1]).slice(0, 20)\n\t\t\tvis.april15Data = restructureData(datasets[2]).slice(0,20)\n\t\t\tvis.update(\"march15\")\n\t\t})\n\t}\n\n\tupdate(date) {\n\t\tconst vis = this\n\n\t\t//vis.data = (date == \"march15\") ? vis.march15Data : vis.april15Data;\n\n\t\tif (date == \"march15\") vis.data = vis.march15Data\n\t\telse if (date == \"april16\") vis.data = vis.march16Data\n\t\telse if (date == \"april15\") vis.data = vis.april15Data\n\n\n\t\tconst month = date.slice(0, -2).charAt(0).toUpperCase() + date.slice(0, -2).slice(1) \n\t\tconst convertedDate = date.substr(date.length-2);\n\t\tconst converted_month_date = month.concat(\" \", convertedDate)\n\n\t\t//console.log(\"converted date month\", converted_month_date)\n\n\n\t\tvis.xLabel.text(`Top Trending Videos on ${converted_month_date}`)\n\n\t\tconst x = d3.scaleBand()\n      .range([0, WIDTH])\n      .domain(vis.data.map((d) => d.videoTitle))\n      .padding(0.5)\n    const xAxisCall = d3.axisBottom(x)\n    vis.xAxisGroup.transition().duration(500).call(xAxisCall)\n      .selectAll(\"text\")\n      .style(\"font-size\", \"8px\")\n      .attr(\"transform\", \"translate(-10,0)rotate(-45)\")\n      .style(\"text-anchor\", \"end\")\n  \n    const y = d3.scaleLinear()\n        .domain([\n          d3.min(vis.data, d => d.videoCount) *0.95, \n          d3.max(vis.data, d => d.videoCount)\n        ])\n        .range([HEIGHT, 0])\n  \n    const yAxisCall = d3.axisLeft(y)\n    vis.yAxisGroup.transition().duration(500).call(yAxisCall)\n    console.log(\"hello again\")\n\n    // DATA JOIN\n    const rects = vis.svg.selectAll(\"rect\")\n      .data(vis.data)\n\n    // EXIT \n    rects.exit()\n        .transition().duration(500)\n        .attr(\"height\", 0)\n        .attr(\"y\", HEIGHT)\n        .remove()\n\n    // UPDATE \n    rects.transition().duration(500)\n      .attr(\"x\", d => x(d.videoTitle))\n      .attr(\"y\", d => y(d.videoCount))\n      .attr(\"width\", x.bandwidth)\n      .attr(\"height\", d => HEIGHT - y(d.videoCount))\n\n    // ENTER\n    rects.enter().append(\"rect\")\n      .attr(\"x\", d => x(d.videoTitle))\n      .attr(\"width\", x.bandwidth)\n      .attr(\"fill\", \"#5f0f40\")\n      .attr(\"y\", HEIGHT)\n      .transition().duration(500)\n        .attr(\"height\", d => HEIGHT - y(d.videoCount))\n        .attr(\"y\", d => y(d.videoCount))\n\t}\n}\n\nfunction restructureData(raw_data) {\n\tvar USAVideoCount = [];\n\tfor(const videoID in raw_data['US']) {\n\t\tUSAVideoCount.push({\n\t\t\tvideoTitle: videoID,\n\t\t\tvideoCount: Number(raw_data['US'][videoID]['view_count'])\n\t\t});\n\t}\n\tUSAVideoCount = USAVideoCount.sort((a,b) => (a.videoCount < b.videoCount) ? 1: -1) \n\treturn USAVideoCount\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}